webpackJsonp([25],{"6LX7":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("JaHG"),a=n("Zrlr"),r=n.n(a),s=n("wxAW"),o=n.n(s),c=function(){function t(e,n){r()(this,t),this.x=0,this.y=0,this.setXY(e,n)}return o()(t,[{key:"setX",value:function(t){void 0!==t&&(this.x=t)}},{key:"setY",value:function(t){void 0!==t&&(this.y=t)}},{key:"setXY",value:function(t,e){this.setX(t),this.setY(e)}},{key:"addXY",value:function(t,e){void 0!==t&&(this.x+=t),void 0!==e&&(this.y+=e)}},{key:"add",value:function(t){this.addXY(t.x,t.y)}},{key:"rotate00",value:function(e){t.rotate(this,new t(0,0),e)}},{key:"copy",value:function(t){this.setXY(t.x,t.y)}},{key:"clone",value:function(){return new t(this.x,this.y)}}],[{key:"distance",value:function(e,n){return Math.sqrt(t.distancePow2(e,n))}},{key:"distancePow2",value:function(t,e){var n=t.x-e.x,i=t.y-e.y;return Math.pow(n,2)+Math.pow(i,2)}},{key:"rotate",value:function(t,e,n){var i=Math.cos(n),a=Math.sin(n),r=t.x-e.x,s=t.y-e.y;t.x=r*i-s*a+e.x,t.y=r*a+s*i+e.y}}]),t}(),l=function(){function t(e,n,i,a){r()(this,t),this.start=new c,this.end=new c,e instanceof Array?(this.start.setXY(e[0],e[1]),this.end.setXY(e[2],e[3])):(this.start.setXY(e,n),this.end.setXY(i,a))}return o()(t,[{key:"setPoints",value:function(t,e){return this.start=t,this.end=e,this}}],[{key:"getLineK",value:function(t){var e=t.end.x-t.start.x,n=void 0;return 0!==e&&(n=(t.end.y-t.start.y)/e),n}},{key:"getCircleRadians",value:function(t){var e=t.start,n=t.end,i=Math.atan2(n.y-e.y,n.x-e.x);return i<0&&(i+=2*Math.PI),i}},{key:"pointDistance",value:function(t,e){var n=t.start,i=t.end,a=((e.x-n.x)*(i.x-n.x)+(e.y-n.y)*(i.y-n.y))/c.distancePow2(n,i);if(a<=0)return c.distance(n,e);if(a>=1)return c.distance(i,e);var r=a*c.distance(n,i);return Math.sqrt(c.distancePow2(n,e)-Math.pow(r,2))}},{key:"checkLineParallel",value:function(e,n,i){void 0===i&&(i=1e-4);var a=t.getCircleRadians(e),r=t.getCircleRadians(n);Math.PI;if(r>=a){var s=r-a;if(s<=i)return s;if(s-=Math.PI,Math.abs(s)<=i)return s;if(s-=Math.PI,Math.abs(s)<=i)return s}else{var o=a-r;if(o<=i)return-o;if(o-=Math.PI,Math.abs(o)<=i)return-o;if(o-=Math.PI,Math.abs(o)<=i)return-o}return null}},{key:"checkSegmentParallel",value:function(e,n,i,a){var r=t.checkLineParallel(e,n,i);if(null===r)return null;void 0===a&&(a=8);var s=t.checkSegmentsClose(e,n,a);return null!==s?r:null!==(s=t.checkSegmentsClose(n,e,a))?r:null}},{key:"checkSegmentsClose",value:function(e,n,i){var a=t.pointDistance(e,n.start);return a<=i?a:(a=t.pointDistance(e,n.end))<=i?a:null}},{key:"getDistanceOffset",value:function(e,n){var i=t.getLineK(e),a=e.start,r=void 0,s=void 0;if(void 0!==i){var o=a.y-i*a.x;if(0!==i){var l=-1/i;s=i*(r=(o-n.y+l*n.x)/(l-i))+o}else r=n.x,s=a.y}else r=a.x,s=n.y;return new c(r-n.x,s-n.y)}}]),t}(),f=function(){function t(e){r()(this,t),this.translation=new c,this.radians=0,this.points=[],this.setPoints(e)}return o()(t,[{key:"setTranslation",value:function(t,e){return this.translation.setXY(t,e),this}},{key:"setPoints",value:function(t){if(t){var e=[];t.forEach(function(t){e.push(new c(t.x,t.y))}),this.points=e}}},{key:"getWorldLines",value:function(){for(var t=this.getWorldPoints(),e=t.length,n=[],i=0;i<e;i++){var a=new l,r=a.start,s=a.end;r.copy(t[i]),s.copy(t[(i+1)%e]),n.push(a)}return n}},{key:"getWorldPoints",value:function(){for(var t=this.points,e=t.length,n=this.radians,i=this.translation.x,a=this.translation.y,r=[],s=0;s<e;s++){var o=new c;o.copy(t[s]),o.rotate00(n),o.addXY(i,a),r.push(o)}return r}},{key:"draw",value:function(t,e){t.save(),t.translate(this.translation.x,this.translation.y),t.rotate(this.radians),t.beginPath();for(var n=this.points,i=n.length,a=0;a<i;a++)0===a?t.moveTo(n[a].x,n[a].y):t.lineTo(n[a].x,n[a].y);t.closePath(),t.lineWidth=2,t.stroke(),e&&(t.fillStyle="rgba("+e+", 0, 0, 1)",t.fill()),t.restore()}},{key:"draw0",value:function(t){var e=this.getWorldPoints();t.save(),t.beginPath(),e.forEach(function(e,n){0===n?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y),t.fillText(n,e.x,e.y)}),t.closePath(),t.strokeStyle="red",t.stroke(),t.restore()}}]),t}(),d=function(t,e){for(var n=e.length,i=t.getWorldLines(),a=i.length,r=void 0,s=0;s<n;s++){var o=e[s];if(o!==t){var f=o.getWorldLines(),d=f.length,u=void 0,h=void 0;for(u=0;u<d;u++)for(h=0;h<a;h++){var v=l.checkSegmentParallel(i[h],f[u],3*Math.PI/180,5);if(null!==v){(r={}).radians=v;var y=i[h].start;r.distanceOffset=l.getDistanceOffset(f[u],y);var g=y.clone();return c.rotate(g,t.translation,v),g.x=y.x-g.x,g.y=y.y-g.y,r.rotateOffset=g,r}}}}return r},u=function(t,e){for(var n=t.getWorldPoints(),i=n.length,a=e.length,r=0;r<a;r++){var s=e[r];if(s!==t){var o=s.getWorldPoints(),l=o.length,f=void 0,d=void 0;for(f=0;f<l;f++)for(d=0;d<i;d++)if(c.distance(n[d],o[f])<=5){var u=new c(o[f].x-n[d].x,o[f].y-n[d].y);return t.translation.add(u),u}}}},h=function(t,e,n,i,a){var r=[];if(e.forEach(function(t){r.push({x:t.x-n,y:t.y-i})}),"#90D002"===t)return r;if("#6DCEF4"===t||"#E47F23"===t)return a?[r[0],r[1],{x:(r[2].x+r[3].x)/2,y:(r[2].y+r[3].y)/2}]:[{x:(r[0].x+r[1].x)/2,y:(r[0].y+r[1].y)/2},r[2],r[3]];if("#39B44A"===t)return a?[r[0],r[1],r[2]]:[r[1],r[2],r[3]];if("gold"===t||"orange"===t)return a?[r[0],r[1],{x:(r[2].x+r[3].x)/2,y:(r[2].y+r[3].y)/2}]:[{x:(r[0].x+r[1].x)/2,y:(r[0].y+r[1].y)/2},r[2],r[3]];if("#16c6d8"===t){var s=2/3;return a?[r[0],{x:r[0].x+(r[1].x-r[0].x)*s,y:r[0].y+(r[1].y-r[0].y)*s},r[2],{x:r[2].x+(r[3].x-r[2].x)*s,y:r[2].y+(r[3].y-r[2].y)*s}]:(s=1/3,[{x:r[0].x+(r[1].x-r[0].x)*s,y:r[0].y+(r[1].y-r[0].y)*s},r[1],{x:r[2].x+(r[3].x-r[2].x)*s,y:r[2].y+(r[3].y-r[2].y)*s},r[3]])}return[]},v={name:"BlockTangram2",data:function(){return{params:{name:"block-tangram"},canvas:null,selectedObjs:null}},methods:{setParams:function(t){var e=this;this.canvas?this.canvas.loadFromJSON(t.fabricData,function(){console.log("BlockTangram2::setParams() success"),e.canvas.getObjects().forEach(function(t){e.setControlVisibility(t)}),e.canvas.renderAll()}):setTimeout(function(){e.setParams(t)},300)},resetParams:function(){this.isParamsExtra=!0,this.params.fabricData=this.canvas.toJSON()},initFabric:function(){var t=this,e=this.$refs.fabricDiv,n=e.getElementsByTagName("CANVAS")[0];n.setAttribute("width",e.clientWidth+"px"),n.setAttribute("height",e.clientHeight+"px"),fabric.Object.prototype.cornerStyle="circle",fabric.Object.prototype.cornerColor="#148acf",fabric.Object.prototype.cornerSize=20,fabric.Object.prototype.borderColor="#148acf",fabric.Object.prototype.transparentCorners=!1,fabric.Object.prototype.cornerStrokeColor=null,fabric.Object.prototype.borderScaleFactor=1,this.canvas=new fabric.Canvas(n,{selectionBorderColor:"#148acf",selectionLineWidth:2,selectionColor:"rgba(20, 120, 222, 0.3)",selection:!1}),window.tangram=this,window.fabricCanvas=this.canvas,this.canvas.on({"mouse:dblclick":function(e){console.log("mouse:dblclick"),t.selectedObjs&&t.selectedObjs[0]&&(t.selectedObjs[0].flipY=!t.selectedObjs[0].flipY,t.canvas.discardActiveObject(t.selectedObjs[0]),t.canvas.requestRenderAll())},"mouse:up":function(e){!function(t){var e=t.getObjects(),n=t.getActiveObject();if(n){var i=[],a=void 0;e.forEach(function(t){var e=new f(h(t.fill,t.getCoords(),t.left,t.top,t.flipY));e.setTranslation(t.left,t.top),t.fill===n.fill&&(a=e),e.fill=t.fill,i.push(e)});var r=d(a,i);r&&(a.radians+=r.radians,a.translation.add(r.rotateOffset),a.translation.add(r.distanceOffset),n.angle+=r.radians/Math.PI*180,n.left+=r.rotateOffset.x+r.distanceOffset.x,n.top+=r.rotateOffset.y+r.distanceOffset.y);var s=u(a,i);s&&(n.left+=s.x,n.top+=s.y),n.setCoords(),t.requestRenderAll()}}(t.canvas)},"selection:updated":function(e){t.reAdd(),t.selectedObjs=e.selected},"selection:created":function(e){t.selectedObjs=e.selected},"selection:cleared":function(e){console.log("selection:cleared"),t.reAdd(),t.selectedObjs=null}})},reAdd:function(){this.selectedObjs&&this.canvas.bringToFront(this.selectedObjs[0])},addTangramBlocks:function(){var t=this;if(this.canvas){if(this.canvas){var e=new fabric.Rect({width:141.42,height:141.42,left:700,top:400,fill:"#90D002",originX:"center",originY:"center",angle:45});this.addToCanvas(e);var n=new fabric.Triangle({width:400,height:200,left:500,top:400,fill:"#6DCEF4",originX:"center",originY:"center",angle:90});this.addToCanvas(n);var i=new fabric.Triangle({width:400,height:200,left:600,top:300,fill:"#E47F23",originX:"center",originY:"center",angle:180});this.addToCanvas(i);var a=new fabric.Polygon([{x:0,y:200},{x:200,y:0},{x:200,y:200}],{width:294,height:147,left:700,top:500,fill:"#39B44A",originX:"center",originY:"center"});this.addToCanvas(a);var r=new fabric.Triangle({width:200,height:100,left:600,top:450,fill:"gold",originX:"center",originY:"center"});this.addToCanvas(r);var s=new fabric.Triangle({width:200,height:100,left:750,top:300,fill:"orange",originX:"center",originY:"center",angle:-90});this.addToCanvas(s);var o=new fabric.Polygon([{x:100,y:0},{x:300,y:0},{x:200,y:100},{x:0,y:100}],{left:550,top:550,width:308,height:108,fill:"#16c6d8",originX:"center",originY:"center"});this.addToCanvas(o)}}else setTimeout(function(){t.addTangramBlocks()},300)},addToCanvas:function(t){this.setControlVisibility(t),this.canvas.add(t)},animateAngle:function(t){t.animate("angle",360,{duration:2500,onChange:this.canvas.renderAll.bind(this.canvas),onComplete:function(){console.log("animation completed")},easing:fabric.util.ease.easeOutBack})},setControlVisibility:function(t){t.perPixelTargetFind=!0,t.targetFindTolerance=4;var e={tl:!1,tr:!1,br:!1,bl:!1,ml:!1,mt:!1,mr:!1,mb:!1,mtr:!0};for(var n in e)t.setControlVisible(n,e[n])}},created:function(){},mounted:function(){var t=this;Object(i.a)("static/fabric/fabric.min.js",function(){t.initFabric()})}},y={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{ref:"fabricDiv",staticClass:"block-tangram"},[e("canvas",{attrs:{id:"fabric-canvas"}})])},staticRenderFns:[]};var g=n("VU/8")(v,y,!1,function(t){n("9ngF")},"data-v-1d98c3bf",null);e.default=g.exports},"9ngF":function(t,e,n){var i=n("xL4A");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);n("rjj0")("8633eb12",i,!0,{})},xL4A:function(t,e,n){(t.exports=n("FZ+f")(!1)).push([t.i,"\n.block-tangram[data-v-1d98c3bf] {\r\n  width: 100%;\r\n  height: 100%;\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  z-index: 10;\n}\r\n",""])}});